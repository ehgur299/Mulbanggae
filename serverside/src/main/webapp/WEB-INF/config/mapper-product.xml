<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.mul.product.dao.ProductDaoImpl">
  	
  	<insert id="insert" parameterMap="Product">
  		<selectKey keyProperty="no" resultType="Integer" order="BEFORE">
  			SELECT product_seq.NEXTVAL no FROM DUAL
  		</selectKey>
  		INSERT INTO M_PRODUCT 
  		(product_number, product_title, product_name, product_price, product_content, product_url, product_date, user_number, C_ID)
  		VALUES(#{no}, #{title}, #{productname}, #{price}, #{content}, #{url}, SYSDATE, #{user_num}, #{cid})
  	</insert>
  	
  	<resultMap type="Product" id="productResultMap">
  		<id property="no" column="product_number"/>
  		<result property="title" column="product_title"/>
  		<result property="productname" column="product_name" />
  		<result property="price" column="product_price" />
  		<result property="content" column = "product_content"/>
  		<result property="url" column="product_url" />
  		<result property="date" column="product_date"/>
  		<result property="cid" column="C_ID"/>
  		<result property="cname" column="C_Name"/>
  		<result property="user_num" column="user_number"/>
  		<result property="userInfo.nickname" column="user_nickname"/>
  	</resultMap>
  	
  	<select id="select" parameterType="String" resultMap="productResultMap">
  		SELECT 
  		p.product_number, p.product_title, p.product_name, p.product_price, p.product_content, p.product_url, p.product_date,
  		c.c_id, c.c_name
  		u.user_number, u.user_nickname,
  		FROM M_Product p, user_info u, M_Category c 
  		WHERE p.user_number = u.user_number AND product_number = #{no}
  	</select>
  	
  	<select id="selectAll" resultMap="productResultMap">
  		SELECT
  		p.product_number, p.product_title, p.product_name, p.product_price, p.product_content, p.product_url, p.product_date,
  		c.c_id, c.c_name,
  		u.user_number, u.user_nickname
  		FROM M_Product p, user_info u, M_Category c 
  		WHERE p.user_number = u.user_number ORDER BY p.product_number DESC
  	</select>
  	
  	<select id="count" resultMap="productResultMap">
  		SELECT count(*) FROM M_Product WHERE 1=1
  	</select>
  	
  	<update id="update" parameterType="Product">
  		UPDATE M_Product
  		SET product_title = #{title}, product_name = #{productname},
  			product_price = #{price}, product_content = #{content},
  			product_url = #{url}, C_ID = #{cid}
  		WHERE product_number = #{no}
  	</update>
  	
  	<delete id="delete" parameterType="Integer">
  		DELETE FROM M_Product WHERE product_number = #{no}
  	</delete>
  	
  </mapper>